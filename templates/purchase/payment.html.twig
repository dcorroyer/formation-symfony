{% extends 'base.html.twig' %}

{% block title %}
  Payez votre commande avec Stripe
{% endblock title %}

{% block body %}
  <h1>Payez votre commande avec Stripe</h1>

  <form id="payment-form">
    <div id="payment-element">
      <!--Stripe.js injects the Payment Element-->
    </div>
    <button id="submit" class="btn btn-success">
      <div class="spinner hidden" id="spinner"></div>
      <span id="button-text">Payer avec Stripe!</span>
    </button>
    <div id="payment-message" class="hidden"></div>
  </form>
{% endblock body %}

{% block javascripts %}
  {{ parent() }}

  <script src="https://js.stripe.com/v3/"></script>
  <script type="application/javascript">
      const clientSecret = {{ clientSecret }};
      const stripe = Stripe("pk_test_51KaxGsGzMoPIs4eyPR2O5rTz1PT1doxDSfVdduHNbiF8hh8uhk2tvjwz3n5Ts5KK7tUTtJgFNg4RdgYHfHfmGT2t00wovYquWE");

      elements = stripe.elements({ clientSecret });

      const paymentElement = elements.create("payment");
      paymentElement.mount("#payment-element");

      const { error } = stripe.confirmPayment({
          elements,
          confirmParams: {
              // Make sure to change this to your payment completion page
              return_url: "http://localhost:4242/public/checkout.html",
          },
      });

      if (error.type === "card_error" || error.type === "validation_error") {
          console.log(error.message);
      } else {
          console.log("An unexpected error occured.");
      }


  </script>
{% endblock javascripts %}
